@model CoolCareSystem.Models.ServiceModel

@{
    ViewBag.Title = Model.ProductName;
}

<p class="title text-center">Product - @Model.ProductName</p>
<br />

<div class="row" id="productDetails">
    <div class="col-xs-12 col-md-4">
        <p><b>Service Issue</b></p>
        <span> @Html.Raw(Model.Service_Issue)</span>
    </div>
    <div class="col-xs-12 col-md-8">
        <p><span class="col-md-3"><b>UserName </b></span><span>- @Html.DisplayFor(model => model.UserName)</span></p>
        <p><span class="col-md-3"><b>Mobile Number </b></span><span>- @Html.DisplayFor(model => model.MobileNumber).ToString().Remove(10)</span></p>
        <p><span class="col-md-3"><b>Requested At </b></span><span>- @Html.DisplayFor(model => model.RequestedAt)</span></p>
        @if (Model.WorkerId == 0)
        {
            <div>
                <span class="col-md-3"><b>Assign To</b></span>
                <div class="col-md-9" style="padding:0px">
                    @(Html.DevExtreme().SelectBoxFor(m=>m.WorkerId)
                            .ID("workerSelectBox")
                            .DataSource(Model.Workers)
                            .DisplayExpr("Worker_Name")
                            .ValueExpr("Id")
                            .Value(0)
                            .Width(300)
                        )
                </div>
            </div>
            <br />
            <br />

        }
        else
        {
            <p><span class="col-md-3"><b>Assigned To </b></span><span>- @Html.DisplayFor(model => model.WorkerName)</span></p>
        }
        @if (Model.Price == null)
        {
            <div>
                <span class="col-md-3"><b>Estimated Price</b></span>
                <div class="col-md-9" style="padding:0px">
                    @(Html.DevExtreme().NumberBoxFor(m=>m.Price)
                        .ID("priceNumberBox")
                        .Format("₹ #,##0.##")
                        .Value(0)
                        .Width(300)
                    )
                </div>
            </div>
        }
        else
        {
            <p><span class="col-md-3"><b>Estimated Price</b></span><span>-₹ @Html.DisplayFor(model => model.Price)</span></p>
        }
        <br />
        @if ((bool)Model.IsApproved == false)
        {
            <a href="#" class="approveProduct btn btn-primary btn-sm">Approve</a>
            @Html.ActionLink("Back to services", "Service", "Service", new { @class = "btn btn-primary pull-right btn-sm" })
        }
        else
        {
            <a href="#" class="btn btn-primary disabled btn-sm">Approved</a>
            @Html.ActionLink("Back to services", "Service", "Service", new { @class = "btn btn-primary pull-right btn-sm" })
        }
    </div>
</div>
<br />
<div class="alert-note">
    <p class="alert alert-success alert-message ajaxMsg">
        Service Approved
    </p>
    <p class="alert alert-warning alert-message ajaxMsg2">
        Select the worker
    </p>
    <p class="alert alert-warning alert-message ajaxMsg3">
        Give the estimation amount
    </p>
</div>
<br />

@section Scripts {
    <script src="~/Scripts/account.js"></script>
    <script>
        $(function () {
            $("a.approveProduct").click(function (e) {
                e.preventDefault();
                var workerVal = $("#workerSelectBox").dxSelectBox("instance").option("value");
                var priceVal = $("#priceNumberBox").dxNumberBox("instance").option("value");
                if (workerVal == 0) {
                    $("p.ajaxMsg2").addClass("divInline");
                    setTimeout(function () {
                        $("p.ajaxMsg2").fadeOut("fast");
                        $("p.ajaxMsg2").removeClass("divInline");
                    }, 1000);
                }
                else if (priceVal == "" || priceVal == "0")
                {
                    $("p.ajaxMsg3").addClass("divInline");
                    setTimeout(function () {
                        $("p.ajaxMsg3").fadeOut("fast");
                        $("p.ajaxMsg3").removeClass("divInline");
                    }, 1000);
                }
                else {
                var url = "/Admin/Service/ApproveService";
                    $.get(url, { id: @Model.Id , WorkerId: workerVal, price: priceVal}, function (data) {
                    var status = data
                }).done(function () {
                    $("p.ajaxMsg").addClass("divInline");
                    setTimeout(function () {
                        $("p.ajaxMsg").fadeOut("fast");
                        $("p.ajaxMsg").removeClass("divInline");
                    }, 1000);
                    setTimeout(function () {
                        location.reload();
                    }, 1000);
                });
                }
            });
        });
    </script>
}
